<ion-header [translucent]="true">
  <ion-toolbar class="gradient-toolbar">
    <ion-title class="text-gradient-primary animate-fade-in">My Reservations</ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/customer/browse-shops" class="animate-fade-in"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="reservations-content">
  <ion-header collapse="condense">
    <ion-toolbar class="gradient-toolbar">
      <ion-title size="large" class="text-gradient-primary">My Reservations</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Hero Section -->
  <div class="hero-section animate-fade-in-up">
    <div class="hero-content">
      <ion-icon name="restaurant-outline" class="hero-icon animate-bounce-in"></ion-icon>
      <h1 class="hero-title text-gradient-primary">Your Dining Adventures</h1>
      <p class="hero-subtitle">Manage your reservations with ease</p>
    </div>
  </div>

  <!-- View Reservations Button -->
  <ion-card class="action-card card-glass animate-fade-in-up animate-delay-200">
    <ion-card-content class="action-content">
      <ion-button fill="solid" class="btn-gradient-primary animate-pulse" (click)="viewMyReservations()" expand="block" size="large">
        <ion-icon name="list-outline" slot="start" class="animate-float"></ion-icon>
        <span class="btn-text">View My Reservations</span>
        <ion-icon name="chevron-forward-outline" slot="end"></ion-icon>
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Reservations Modal -->
  <ion-modal [isOpen]="showReservationsModal" (willDismiss)="closeReservationsModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>My Reservations</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeReservationsModal()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <!-- Loading Spinner -->
        <ion-card *ngIf="isLoading">
          <ion-card-content>
            <ion-spinner name="crescent"></ion-spinner>
            <p>Loading reservations...</p>
          </ion-card-content>
        </ion-card>

        <!-- No Reservations -->
        <ion-card *ngIf="!isLoading && reservations.length === 0">
          <ion-card-content>
            <ion-text color="medium">
              <p>You haven't made any reservations yet.</p>
            </ion-text>
          </ion-card-content>
        </ion-card>

        <!-- Reservations List -->
        <ion-card *ngFor="let reservation of reservations" class="reservation-card">
          <ion-card-header>
            <ion-card-title>{{ getShopName(reservation.shopId) || 'Shop' }}</ion-card-title>
            <ion-card-subtitle>
              <ion-badge [color]="getStatusColor(reservation.status)">
                {{ reservation.status | titlecase }}
              </ion-badge>
            </ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            <ion-row>
              <ion-col size="6">
                <p><strong>Date & Time:</strong></p>
                <p>{{ reservation.reservationDate | date:'medium' }}</p>
              </ion-col>
              <ion-col size="6">
                <p><strong>Weekday:</strong></p>
                <p>{{ reservation.weekday | titlecase }}</p>
              </ion-col>
            </ion-row>

            <ion-row>
              <ion-col size="6">
                <p><strong>Seats Requested:</strong> {{ reservation.seatsRequested }}</p>
              </ion-col>
              <ion-col size="6">
                <p><strong>Table Number:</strong> {{ reservation.tableNumber || 'Not assigned yet' }}</p>
              </ion-col>
            </ion-row>

            <ion-row *ngIf="reservation.seatNumber">
              <ion-col size="12">
                <p><strong>Seat Number:</strong> {{ reservation.seatNumber }}</p>
              </ion-col>
            </ion-row>

            <ion-row>
              <ion-col size="6">
                <p><strong>Status:</strong> {{ reservation.status | titlecase }}</p>
              </ion-col>
              <ion-col size="6">
                <p><strong>Contact Number:</strong></p>
                <p>{{ reservation.contactNumber }}</p>
              </ion-col>
            </ion-row>

            <ion-row>
              <ion-col size="12">
                <p><strong>Customer Email:</strong> {{ reservation.customerEmail }}</p>
              </ion-col>
            </ion-row>

            <p *ngIf="reservation.message"><strong>Special Requests:</strong> {{ reservation.message }}</p>

            <!-- Action Buttons -->
            <ion-row *ngIf="reservation.status === 'pending' || reservation.status === 'accepted'">
              <ion-col size="6">
                <ion-button fill="outline" color="danger" (click)="cancelReservation(reservation)" size="small" [disabled]="!canCancelReservation(reservation)">
                  <ion-icon name="close-circle-outline" slot="start"></ion-icon>
                  Cancel
                </ion-button>
                <ion-text color="medium" style="display: block; font-size: 12px; margin-top: 4px;">
                  <p *ngIf="!canCancelReservation(reservation)">Can only cancel within 10 min</p>
                </ion-text>
              </ion-col>
              <ion-col size="6">
                <ion-button fill="solid" color="primary" (click)="callShop(reservation)" size="small">
                  <ion-icon name="call-outline" slot="start"></ion-icon>
                  Call
                </ion-button>
              </ion-col>
            </ion-row>

            <!-- Rate Shop Button for completed reservations -->
            <ion-row *ngIf="reservation.status === 'done'">
              <ion-col size="12">
                <ion-button fill="solid" color="success" (click)="rateShop(reservation)" size="small" expand="block">
                  <ion-icon name="star-outline" slot="start"></ion-icon>
                  Rate Shop
                </ion-button>
              </ion-col>
            </ion-row>
          </ion-card-content>
        </ion-card>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
