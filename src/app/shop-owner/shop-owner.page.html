<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>My Shops</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">My Shops</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Add Shop FAB -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="shops.length < 2">
    <ion-fab-button (click)="showCreateModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Shops List -->
  <ion-card *ngFor="let shop of shops">
    <ion-card-header>
      <ion-card-title>{{ shop.name }}</ion-card-title>
      <ion-card-subtitle>{{ shop.category }}</ion-card-subtitle>
      <ion-button fill="clear" color="danger" slot="end" (click)="removeShop(shop)">
        <ion-icon name="trash" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Description:</strong> {{ shop.description }}</p>
      <p><strong>Email:</strong> {{ shop.email }}</p>
      <p><strong>Phone:</strong> {{ shop.phone }}</p>
      <p><strong>Total Seats:</strong> {{ shop.totalSeats }}</p>
      <p><strong>Total Tables:</strong> {{ shop.totalTables }}</p>
      <p><strong>Available Seats:</strong> {{ shop.availableSeats }}
        <ion-button fill="clear" size="small" (click)="updateAvailableSeats(shop)">
          <ion-icon name="create" slot="icon-only"></ion-icon>
        </ion-button>
      </p>
      <p><strong>Available Tables:</strong> {{ shop.availableTables }}
        <ion-button fill="clear" size="small" (click)="updateAvailableTables(shop)">
          <ion-icon name="create" slot="icon-only"></ion-icon>
        </ion-button>
      </p>
      <p><strong>Opening Time:</strong> {{ shop.openingTime }}
        <ion-button fill="clear" size="small" (click)="updateOpeningTime(shop)">
          <ion-icon name="create" slot="icon-only"></ion-icon>
        </ion-button>
        <ion-button fill="clear" size="small" (click)="setToNow(shop, 'openingTime')">
          <ion-icon name="time" slot="icon-only"></ion-icon>
        </ion-button>
      </p>
      <p><strong>Closing Time:</strong> {{ shop.closingTime }}
        <ion-button fill="clear" size="small" (click)="updateClosingTime(shop)">
          <ion-icon name="create" slot="icon-only"></ion-icon>
        </ion-button>
        <ion-button fill="clear" size="small" (click)="setToNow(shop, 'closingTime')">
          <ion-icon name="time" slot="icon-only"></ion-icon>
        </ion-button>
        <ion-button fill="clear" size="small" (click)="extendOneHour(shop)">
          <ion-icon name="add-circle" slot="icon-only"></ion-icon>
        </ion-button>
      </p>
      <p><strong>Reservation Date:</strong> {{ shop.reservationDate }}</p>
      <p><strong>Status:</strong>
        <ion-toggle [checked]="shop.isOpen" (ionChange)="toggleShopStatus(shop)" slot="end"></ion-toggle>
        {{ shop.isOpen ? 'Open' : 'Closed' }}
      </p>
    </ion-card-content>
  </ion-card>

  <!-- No Shops Message -->
  <ion-card *ngIf="shops.length === 0">
    <ion-card-content>
      <p class="no-shops-message">You haven't created any shops yet.</p>
      <ion-button expand="block" (click)="showCreateModal()">
        <ion-icon name="add-circle" slot="start"></ion-icon>
        Create Your First Shop
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Create Shop Modal -->
  <ion-modal [isOpen]="isCreating" (willDismiss)="isCreating = false">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Create New Shop</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="isCreating = false">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <form [formGroup]="createShopForm" (ngSubmit)="createShop()">
          <ion-card>
            <ion-card-header>
              <ion-card-title>Shop Details</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-item>
                <ion-label position="stacked">Shop Name *</ion-label>
                <ion-input formControlName="name" placeholder="Enter shop name"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Contact Email *</ion-label>
                <ion-input formControlName="email" type="email" placeholder="Enter email"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Contact Phone *</ion-label>
                <ion-input formControlName="phone" placeholder="Enter phone number"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Description *</ion-label>
                <ion-textarea formControlName="description" placeholder="Describe your shop"></ion-textarea>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Category *</ion-label>
                <ion-select formControlName="category" placeholder="Select category">
                  <ion-select-option *ngFor="let cat of categories" [value]="cat">{{cat}}</ion-select-option>
                </ion-select>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Total Seats *</ion-label>
                <ion-input formControlName="totalSeats" type="number" min="1"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Total Tables *</ion-label>
                <ion-input formControlName="totalTables" type="number" min="1"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Available Seats *</ion-label>
                <ion-input formControlName="availableSeats" type="number" min="0"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Available Tables *</ion-label>
                <ion-input formControlName="availableTables" type="number" min="0"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Opening Time *</ion-label>
                <ion-datetime formControlName="openingTime" display-format="HH:mm" picker-format="HH:mm" placeholder="Select opening time"></ion-datetime>
                <ion-button fill="clear" slot="end" (click)="setToNow(null, 'openingTime')">
                  <ion-icon name="time" slot="icon-only"></ion-icon>
                </ion-button>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Closing Time *</ion-label>
                <ion-datetime formControlName="closingTime" display-format="HH:mm" picker-format="HH:mm" placeholder="Select closing time"></ion-datetime>
                <ion-button fill="clear" slot="end" (click)="setToNow(null, 'closingTime')">
                  <ion-icon name="time" slot="icon-only"></ion-icon>
                </ion-button>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Reservation Date *</ion-label>
                <ion-datetime formControlName="reservationDate" display-format="YYYY-MM-DD" picker-format="YYYY-MM-DD" placeholder="Select date"></ion-datetime>
              </ion-item>

              <ion-item>
                <ion-label>Shop Status</ion-label>
                <ion-toggle formControlName="isOpen" slot="end"></ion-toggle>
              </ion-item>
            </ion-card-content>
          </ion-card>

          <ion-card>
            <ion-card-header>
              <ion-card-title>Shop Location</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div id="map" style="height: 300px; width: 100%;"></div>

              <ion-item>
                <ion-label position="stacked">Latitude</ion-label>
                <ion-input formControlName="latitude" type="number" step="0.000001"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Longitude</ion-label>
                <ion-input formControlName="longitude" type="number" step="0.000001"></ion-input>
              </ion-item>

              <ion-button expand="block" (click)="saveLocation()" color="secondary">
                <ion-icon name="location" slot="start"></ion-icon>
                Save Location
              </ion-button>
            </ion-card-content>
          </ion-card>

          <ion-button expand="block" type="submit" [disabled]="createShopForm.invalid || isLoading">
            <ion-icon name="save" slot="start"></ion-icon>
            Create Shop
          </ion-button>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Customer Reservations -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Customer Reservations</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-accordion-group>
        <ion-accordion *ngFor="let reservation of reservations" [value]="reservation.id">
          <ion-item slot="header">
            <ion-label>
              <h2>{{reservation.customerName}}</h2>
              <p>{{reservation.reservationDate}} at {{reservation.reservationTime}}</p>
              <p>Table: {{reservation.tableNumber}} | Seat: {{reservation.seatNumber}} | Status: {{reservation.status}}</p>
            </ion-label>
          </ion-item>
          <div slot="content">
            <ion-item>
              <ion-label>
                <p><strong>Email:</strong> {{reservation.customerEmail}}</p>
                <p><strong>Phone:</strong> {{reservation.contactNumber}}</p>
                <p><strong>Seats:</strong> {{reservation.numberOfSeats}}</p>
              </ion-label>
            </ion-item>
            <ion-button
              *ngIf="reservation.status === 'pending'"
              fill="outline"
              color="success"
              (click)="confirmReservation(reservation)">
              <ion-icon name="checkmark" slot="start"></ion-icon>
              Confirm
            </ion-button>
            <ion-button
              *ngIf="reservation.status === 'pending'"
              fill="outline"
              color="danger"
              (click)="cancelReservation(reservation)">
              <ion-icon name="close" slot="start"></ion-icon>
              Cancel
            </ion-button>
          </div>
        </ion-accordion>
      </ion-accordion-group>

      <ion-item *ngIf="reservations.length === 0">
        <ion-label>No reservations yet.</ion-label>
      </ion-item>
    </ion-card-content>
  </ion-card>
</ion-content>
