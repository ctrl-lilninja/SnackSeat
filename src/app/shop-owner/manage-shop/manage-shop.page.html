<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Manage Shop</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Manage Shop</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Create Shop Button if no shop exists -->
  <div *ngIf="!shop" class="create-shop-container">
    <ion-button expand="block" size="large" color="primary" (click)="showCreateModal()">
      <ion-icon name="add-circle" slot="start"></ion-icon>
      âž• Create Shop
    </ion-button>
  </div>

  <!-- Shop Owner Details Card if shop owner exists -->
  <ion-card *ngIf="shopOwner">
    <ion-card-header>
      <ion-card-title>{{ shopOwner.shopName }}</ion-card-title>
      <ion-card-subtitle>{{ shopOwner.category }}</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Description:</strong> {{ shopOwner.description }}</p>
      <p><strong>Email:</strong> {{ shopOwner.email }}</p>
      <p><strong>Contact:</strong> {{ shopOwner.contactNumber }}</p>
      <p><strong>Total Seats:</strong> {{ shopOwner.seats }}</p>
      <p><strong>Available Seats:</strong> {{ shopOwner.availableSeats }}
        <ion-button fill="clear" size="small" (click)="updateAvailableSeats()">
          <ion-icon name="create" slot="icon-only"></ion-icon>
        </ion-button>
      </p>
      <p><strong>Opening Time:</strong> {{ shopOwner.openingTime }}
        <ion-button fill="clear" size="small" (click)="updateOpeningTime()">
          <ion-icon name="create" slot="icon-only"></ion-icon>
        </ion-button>
      </p>
      <p><strong>Closing Time:</strong> {{ shopOwner.closingTime }}
        <ion-button fill="clear" size="small" (click)="updateClosingTime()">
          <ion-icon name="create" slot="icon-only"></ion-icon>
        </ion-button>
      </p>
      <p><strong>Reservation Date:</strong> {{ shopOwner.reservationDate }}
        <ion-button fill="clear" size="small" (click)="updateReservationDate()">
          <ion-icon name="create" slot="icon-only"></ion-icon>
        </ion-button>
      </p>
      <p><strong>Status:</strong> {{ shopOwner.isOpen ? 'Open' : 'Closed' }}</p>
    </ion-card-content>
  </ion-card>

  <!-- Shops List Card -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>My Shops</ion-card-title>
      <ion-button fill="clear" slot="end" (click)="showCreateModal()">
        <ion-icon name="add-circle" slot="start"></ion-icon>
        Add Shop
      </ion-button>
    </ion-card-header>
    <ion-card-content>
      <div *ngIf="shops.length > 0; else noShops">
        <ion-card *ngFor="let shop of shops" style="margin-bottom: 16px;">
          <ion-card-header>
            <ion-card-title>{{ shop.name }}</ion-card-title>
            <ion-card-subtitle>{{ shop.category }}</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <p><strong>Description:</strong> {{ shop.description }}</p>
            <p><strong>Available Seats:</strong> {{ shop.availableSeats }}</p>
            <p><strong>Status:</strong> {{ shop.isOpen ? 'Open' : 'Closed' }}</p>
            <p><strong>Opening Time:</strong> {{ shop.openingTime }}</p>
            <p><strong>Closing Time:</strong> {{ shop.closingTime }}</p>
            <p><strong>Reservation Date:</strong> {{ shop.reservationDate }}</p>
            <ion-button fill="outline" color="danger" (click)="removeShop(shop)">
              <ion-icon name="trash" slot="start"></ion-icon>
              Remove
            </ion-button>
          </ion-card-content>
        </ion-card>
      </div>
      <ng-template #noShops>
        <ion-item>
          <ion-label>
            <p>No shops yet. Click "Add Shop" to create your first shop.</p>
          </ion-label>
        </ion-item>
      </ng-template>
    </ion-card-content>
  </ion-card>

  <!-- Create Shop Modal -->
  <ion-modal [isOpen]="isCreating" (willDismiss)="isCreating = false">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Create Shop</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="isCreating = false">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <form [formGroup]="createShopForm" (ngSubmit)="createShop()">
          <ion-card>
            <ion-card-header>
              <ion-card-title>Shop Details</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-item>
                <ion-label position="stacked">Shop Name *</ion-label>
                <ion-input formControlName="shopName" placeholder="Enter shop name"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Contact Email *</ion-label>
                <ion-input formControlName="email" type="email" placeholder="Enter email"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Contact Number *</ion-label>
                <ion-input formControlName="contactNumber" placeholder="Enter phone number"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Description *</ion-label>
                <ion-textarea formControlName="description" placeholder="Describe your shop"></ion-textarea>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Category *</ion-label>
                <ion-select formControlName="category" placeholder="Select category">
                  <ion-select-option *ngFor="let cat of categories" [value]="cat">{{cat}}</ion-select-option>
                </ion-select>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Total Seats *</ion-label>
                <ion-input formControlName="seats" type="number" min="1"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Available Seats *</ion-label>
                <ion-input formControlName="availableSeats" type="number" min="0"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Opening Time *</ion-label>
                <ion-datetime formControlName="openingTime" display-format="HH:mm" picker-format="HH:mm"></ion-datetime>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Closing Time *</ion-label>
                <ion-datetime formControlName="closingTime" display-format="HH:mm" picker-format="HH:mm"></ion-datetime>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Reservation Date Availability *</ion-label>
                <ion-datetime formControlName="reservationDate" display-format="YYYY-MM-DD" picker-format="YYYY-MM-DD"></ion-datetime>
              </ion-item>

              <ion-item>
                <ion-label>Shop Status</ion-label>
                <ion-toggle formControlName="isOpen" slot="end"></ion-toggle>
              </ion-item>
            </ion-card-content>
          </ion-card>

          <ion-card>
            <ion-card-header>
              <ion-card-title>Shop Location</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div id="map" style="height: 300px; width: 100%;"></div>

              <ion-item>
                <ion-label position="stacked">Latitude</ion-label>
                <ion-input formControlName="location.lat" type="number" step="0.000001"></ion-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Longitude</ion-label>
                <ion-input formControlName="location.lng" type="number" step="0.000001"></ion-input>
              </ion-item>

              <ion-button expand="block" (click)="saveLocation()" color="secondary">
                <ion-icon name="location" slot="start"></ion-icon>
                Save Location
              </ion-button>
            </ion-card-content>
          </ion-card>

          <ion-button expand="block" type="submit" [disabled]="createShopForm.invalid || isLoading">
            <ion-icon name="save" slot="start"></ion-icon>
            Create Shop
          </ion-button>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Customer Reservations -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Customer Reservations</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-accordion-group>
        <ion-accordion *ngFor="let reservation of reservations" [value]="reservation.id">
          <ion-item slot="header">
            <ion-label>
              <h2>{{reservation.customerName}}</h2>
              <p>{{reservation.reservationDate}} at {{reservation.reservationTime}}</p>
              <p>Seats: {{reservation.numberOfSeats}} | Status: {{reservation.status}}</p>
            </ion-label>
          </ion-item>
          <div slot="content">
            <ion-item>
              <ion-label>
                <p><strong>Email:</strong> {{reservation.customerEmail}}</p>
                <p><strong>Phone:</strong> {{reservation.contactNumber}}</p>
              </ion-label>
            </ion-item>
            <ion-button
              *ngIf="reservation.status === 'pending'"
              fill="outline"
              color="success"
              (click)="acceptReservation(reservation)">
              <ion-icon name="checkmark" slot="start"></ion-icon>
              Accept
            </ion-button>
            <ion-button
              *ngIf="reservation.status === 'pending' || reservation.status === 'approved'"
              fill="outline"
              color="danger"
              (click)="cancelReservation(reservation)">
              <ion-icon name="close" slot="start"></ion-icon>
              Cancel
            </ion-button>
          </div>
        </ion-accordion>
      </ion-accordion-group>

      <ion-item *ngIf="reservations.length === 0">
        <ion-label>No reservations yet.</ion-label>
      </ion-item>
    </ion-card-content>
  </ion-card>
</ion-content>
